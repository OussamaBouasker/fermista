
{% extends 'Front/frontbase.html.twig' %}


{% block title %}Nouvelle Commande{% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center">Passer une Nouvelle Commande</h2>

    <div class="row justify-content-center">
        <div class="col-md-8">
            {{ form_start(form) }}
            <div class="card p-4">
                <h4>Informations de Commande</h4>
                <div class="form-group">
                    {{ form_row(form.nom) }}
                </div>
                <div class="form-group">
                    {{ form_row(form.email) }}
                </div>
                <div class="form-group">
                    {{ form_row(form.localisation) }}
                </div>

                <button type="submit" class="btn btn-primary mt-3">Commander</button>
            </div>
            {{ form_end(form) }}
        </div>
    </div>

    <!-- Intégration de la carte Leaflet -->
    <div id="map" style="height: 300px; margin-top: 30px;"></div>
</div>

<!-- Ajout des scripts pour Leaflet -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // Initialisation de la carte Leaflet avec les coordonnées de départ
    var map = L.map('map').setView([36.8065, 10.1815], 13); // Coordonnées par défaut (ex : Tunis)

    // Ajout du fond de carte
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    // Ajouter un marqueur par défaut
    var marker = L.marker([36.8065, 10.1815]).addTo(map);

    // Lorsque l'on clique sur la carte, déplacer le marqueur à l'endroit cliqué et mettre à jour la localisation
    map.on('click', function (e) {
        marker.setLatLng(e.latlng);  // Déplacer le marqueur
        // Mettre à jour la valeur du champ caché avec les nouvelles coordonnées
        document.querySelector('[name="commande[localisation]"]').value = e.latlng.lat + ',' + e.latlng.lng;
    });

    // Si une localisation a déjà été définie, mettre à jour le marqueur sur la carte
    var localisation = document.querySelector('[name="commande[localisation]"]').value;
    if (localisation) {
        var coords = localisation.split(',');
        var lat = parseFloat(coords[0]);
        var lng = parseFloat(coords[1]);
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], 13); // Déplacer la carte à la localisation enregistrée
    }
</script>

{% endblock %}
